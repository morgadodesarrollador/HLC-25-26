


jenkins:
  controller:
    # AsegÃºrate de que esto estÃ© habilitado
    # serviceAccount:
    #   create: true
    #   name: jenkins

    JCasC:
      enabled: true
      defaultConfig: true
      overwriteConfiguration: false
    
    sidecars:
      configAutoReload:
        enabled: false  # Esto evita que el init container se ejecute
    
    # El sidecar necesita estos permisos
    # rbac:
    #   create: true
    #   readSecrets: false # MantÃ©n esto en false si no necesitas recarga automÃ¡tica
    
    # JCasC:
    #   enabled: true
    #   defaultConfig: false # â›” importante: ya tienes tu propio ConfigMap
    
    configAsCode:
      enabled: false #Si NO haces esto, Helm intentarÃ¡ crear otro ConfigMap

    # sidecars:
    #   configAutoReload:
    #     enabled: false
        

    image:
      repository: jenkins/jenkins
      tag: "2.541.1-lts-jdk21"

    runAsUser: 0
    fsGroup: 0

    admin:
      username: admin
      password: admin123

    persistence:
      enabled: true
      size: 8Gi
      storageClass: microk8s-hostpath   # ðŸ‘ˆ clave

    serviceType: ClusterIP

    ingress:
      enabled: true
      ingressClassName: nginx
      hostName: jenkins.jamorgado.es
      # annotations:
      #   cert-manager.io/cluster-issuer: letsencrypt-prod
      #   nginx.ingress.kubernetes.io/ssl-redirect: "true"
      # tls:
      #   - secretName: jenkins-jamorgado-es-tls
      #     hosts:
      #       - jenkins.jamorgado.es
    installPlugins:
      - configuration-as-code
      - kubernetes
      - workflow-aggregator
      - credentials
      - github
      - git
  
  # ðŸ”´ CLAVE: desactivar JCasC


  #     configScripts:
  #       base: |
  #         jenkins:
  #           systemMessage: "Jenkins desplegado con Helm + JCasC"
  #           numExecutors: 2

  #           securityRealm:
  #             local:
  #               allowsSignup: false
  #               users:
  #                 - id: "admin"
  #                   password: "admin123"

  #           authorizationStrategy:
  #             loggedInUsersCanDoAnything:
  #               allowAnonymousRead: false

  # ðŸ”´ CLAVE: desactivar sidecar
  # sidecars:
  #   configAutoReload:
  #     enabled: false
  # sidecars:
  #   configAutoReload:
  #     env:
  #       - name: DISABLE_X509_STRICT_VERIFICATION
  #         value: "true"